<!DOCTYPE html>
<html>
    <head>
        <title>Werw√∂lfle</title>


        <style>

            * {
                background-color: black;
                color: white;
            }
            h1 {text-align: center;}
            input{margin:auto;display:block;}
            button#add{margin:auto;display:block;}
            button#start{margin-left:10%;display:block;}
            button#start.hidden {display: none;}
            text#game{margin-left:70%;margin-top:4%;position:absolute;display: block;}
            text#game.hidden{display: none;}

        

        </style>
    </head>
    <body>
        <h1>Welcome to Millers Hollow</h1>
        <text id=game class="hidden">Hallo <span id="test"></span>du da</text>
        <input id="addname" placeholder="Name" type="text">
        <br>
        <button id="add">Add</button>
        <table id="playerlist">
            <tr class="tablehead">
                <th>Name</th>
                <th>Role</th>
                <th>Lovers</th>
                <th>Captain</th>
                <th>Dead</th>
            </tr>
        </table>
        <button id="start" class="hidden">Start</button>
        <script>
            const addButton = document.getElementById("add")
            addButton.addEventListener("click",addPlayer)
            const playerlist = document.querySelector("#playerlist")
            const addnameinput = document.querySelector("#addname")

            const startButton = document.getElementById("start")
            startButton.addEventListener("click",startGame)

            players = [ ]

            function startGame() {
                document.getElementById("game").classList.remove("hidden")
                document.getElementById("test").innerHTML = players.filter(player => player.role == "villager").map(player => player.name).join(", ");
                document.getElementById("t").innerHTML = players.filter(player => player.role == "thief").map(player => player.name).join(", ");
                document.getElementById("tst").innerHTML = players.filter(player => player.role == "witch").map(player => player.name).join(", ");
                document.getElementById("tet").innerHTML = players.filter(player => player.role == "werewolf").map(player => player.name).join(", ");
                document.getElementById("st").innerHTML = players.filter(player => player.role == "fortune_teller").map(player => player.name).join(", ");
                document.getElementById("t").innerHTML = players.filter(player => player.role == "cupid").map(player => player.name).join(", ");
                document.getElementById("tests").innerHTML = players.filter(player => player.role == "hunter").map(player => player.name).join(", ");
                document.getElementById("testss").innerHTML = players.filter(player => player.role == "little_girl").map(player => player.name).join(", ");

            }

            function addPlayer() {
                players.push({
                    name: addnameinput.value,
                    role: "villager",
                    isLover: false,
                    isCaptain: false,
                    isDead: false,
                })
                addnameinput.value = "";
                render()

            }

            function render() {
                document.querySelectorAll("#playerlist tr:not(.tablehead)").forEach(elem => {elem.remove()})
                players.forEach((player, i) => {
                    tr=document.createElement("tr")
                    tr.setAttribute("data-which", i)
                    playerlist.appendChild(tr)

                    td1=document.createElement("td")
                    td1.textContent = player.name;
                    tr.appendChild(td1)

                    td2=document.createElement("td")
                    td2.innerHTML=`<select name="role" class="role" oninput="toggleRole(event)">
                                    <option value="vilager" ${player.role=="vilager" ? "selected" : ""}>Villager</option>
                                    <option value="werewolf" ${player.role=="werewolf" ? "selected" : ""}>Werewolf</option>
                                    <option value="witch" ${player.role=="witch" ? "selected" : ""}>Witch</option>
                                    <option value="fortune_teller" ${player.role=="fortune_teller" ? "selected" : ""}>Fortune Teller</option>
                                    <option value="thief" ${player.role=="thief" ? "selected" : ""}>Thief</option>
                                    <option value="cupid" ${player.role=="cupid" ? "selected" : ""}>Cupid</option>
                                    <option value="hunter" ${player.role=="hunter" ? "selected" : ""}>Hunter</option>
                                    <option value="little_girl" ${player.role=="little_girl" ? "selected" : ""}>Little Girl</option>
                                  </select>`
                    tr.appendChild(td2)

                    td3=document.createElement("td")
                    td3.innerHTML='<input type="checkbox" onclick="toggleLover(event)" class="isLover"><br>';
                    tr.appendChild(td3)

                    td5=document.createElement("td")
                    td5.innerHTML='<input type="checkbox" onclick="toggleCaptain(event)" class="isCaptain"><br>';
                    tr.appendChild(td5)

                    td4=document.createElement("td")
                    td4.innerHTML='<input type="checkbox" onclick="toggleDead(event)" class="isDead"><br>';
                    tr.appendChild(td4)
                
                    
                });
                tr=document.createElement("tr")
                document.getElementById("start").classList.remove("hidden")
                playerlist.appendChild(tr)
            }

            function toggleRole() {
                var row = event.target.closest("tr")
                console.log(row)
                var select = row.querySelector('.role');
                console.log(select)
                var i = row.dataset.which
                players[Number(i)].role = select.value
                console.log(i, players)
            }
            function toggleLover()
            {
                var row = event.target.closest("tr")
                var checkbox = row.querySelector('.isLover');
                var i = row.dataset.which
                players[Number(i)].isLover = checkbox.checked
                console.log(i, players)
            }
            function toggleCaptain()
            {
                var row = event.target.closest("tr")
                var checkbox = row.querySelector('.isCaptain');
                var i = row.dataset.which
                players[Number(i)].isCaptain = checkbox.checked
                console.log(i, players)
            }
            function toggleDead()
            {
                var row = event.target.closest("tr")
                var checkbox = row.querySelector('.isDead');
                var i = row.dataset.which
                players[Number(i)].isDead = checkbox.checked
                console.log(i, players)
            }

        </script>

    </body>
</html>